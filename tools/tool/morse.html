<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·å¤‰æ›ãƒ„ãƒ¼ãƒ«ï¼ˆè‹±èªãƒ»æ—¥æœ¬èªãƒ»éŸ³ãƒ»ãƒ€ãƒ¼ã‚¯å¯¾å¿œï¼‰</title>
  <style>
    :root {
      --bg-color: #f3f4f6;
      --text-color: #222;
      --accent: #4caf50;
      --border-color: #ccc;
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #e6e6e6;
      --accent: #81c784;
      --border-color: #444;
    }

    body {
      font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      text-align: center;
      padding: 40px;
      transition: background-color 0.3s, color 0.3s;
    }

    h1 {
      color: var(--text-color);
    }

    textarea {
      width: 80%;
      height: 120px;
      font-size: 1.2em;
      margin: 15px 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background-color: inherit;
      color: var(--text-color);
    }

    select, button {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      margin: 5px;
      background-color: inherit;
      color: var(--text-color);
    }

    button.action {
      background-color: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
    }

    button.action:hover {
      opacity: 0.9;
    }

    #result {
      margin-top: 25px;
      font-size: 1.5em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ğŸ”  ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>

  <div>
    <label for="mode">è¨€èªãƒ¢ãƒ¼ãƒ‰ï¼š</label>
    <select id="mode">
      <option value="english">è‹±èªãƒ¢ãƒ¼ãƒ‰ï¼ˆAã€œZ, æ•°å­—ï¼‰</option>
      <option value="japanese">æ—¥æœ¬èªãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰</option>
    </select>

    <label for="direction">å¤‰æ›æ–¹å‘ï¼š</label>
    <select id="direction">
      <option value="text-to-morse">æ–‡å­— â†’ ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·</option>
      <option value="morse-to-text">ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å· â†’ æ–‡å­—</option>
    </select>
  </div>

  <br>

  <textarea id="inputText" placeholder="å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šHELLO ã¾ãŸã¯ ãƒ»ãƒ»ãƒ»ãƒ» ãƒ»ãƒ»ï¼‰"></textarea><br>

  <button class="action" onclick="convert()">å¤‰æ›ã™ã‚‹</button>
  <button onclick="playMorse()">ğŸ”Š éŸ³ã§å†ç”Ÿ</button>
  <button onclick="toggleDarkMode()">ğŸŒ— ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>

  <div id="result"></div>

  <script>
    // === ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« ===
    const morseEN = {
      "A": ".-", "B": "-...", "C": "-.-.", "D": "-..",
      "E": ".", "F": "..-.", "G": "--.", "H": "....",
      "I": "..", "J": ".---", "K": "-.-", "L": ".-..",
      "M": "--", "N": "-.", "O": "---", "P": ".--.",
      "Q": "--.-", "R": ".-.", "S": "...", "T": "-",
      "U": "..-", "V": "...-", "W": ".--", "X": "-..-",
      "Y": "-.--", "Z": "--..",
      "0": "-----", "1": ".----", "2": "..---", "3": "...--",
      "4": "....-", "5": ".....", "6": "-....", "7": "--...",
      "8": "---..", "9": "----.",
      ".": ".-.-.-", ",": "--..--", "?": "..--..", "!": "-.-.--",
      "-": "-....-", "/": "-..-.", "@": ".--.-.", "(": "-.--.", ")": "-.--.-"
    };
    const morseENRev = Object.fromEntries(Object.entries(morseEN).map(([k,v]) => [v,k]));

    const morseJP = {
      "ã‚¢": "ï¼ï¼ãƒ»ï¼ï¼", "ã‚¤": "ï¼ãƒ»ï¼ï¼ï¼", "ã‚¦": "ãƒ»ãƒ»ï¼ãƒ»ãƒ»", "ã‚¨": "ãƒ»ãƒ»ï¼ãƒ»", "ã‚ª": "ãƒ»ï¼ãƒ»ãƒ»ãƒ»",
      "ã‚«": "ãƒ»ï¼", "ã‚­": "ï¼ãƒ»ï¼ãƒ»ãƒ»", "ã‚¯": "ï¼ãƒ»ï¼ï¼", "ã‚±": "ãƒ»ï¼ãƒ»ãƒ»ï¼", "ã‚³": "ï¼ãƒ»",
      "ã‚µ": "ï¼ãƒ»ï¼", "ã‚·": "ï¼ãƒ»ï¼ãƒ»", "ã‚¹": "ï¼ï¼ãƒ»ï¼ãƒ»", "ã‚»": "ï¼ï¼ï¼ãƒ»", "ã‚½": "ãƒ»ï¼ï¼ï¼ãƒ»",
      "ã‚¿": "ï¼ãƒ»ï¼ãƒ»ï¼", "ãƒ": "ï¼ãƒ»ï¼ãƒ»ãƒ»ï¼", "ãƒ„": "ãƒ»ãƒ»ï¼", "ãƒ†": "ãƒ»ï¼ï¼ï¼", "ãƒˆ": "ï¼ãƒ»ï¼ï¼",
      "ãƒŠ": "ãƒ»ï¼ãƒ»", "ãƒ‹": "ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»", "ãƒŒ": "ãƒ»ï¼ãƒ»ï¼", "ãƒ": "ãƒ»ï¼ãƒ»ãƒ»", "ãƒ": "ãƒ»ï¼ãƒ»ï¼ãƒ»",
      "ãƒ": "ï¼ãƒ»ï¼ãƒ»ï¼ï¼", "ãƒ’": "ï¼ãƒ»ï¼ï¼ï¼", "ãƒ•": "ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼", "ãƒ˜": "ãƒ»ãƒ»ï¼ãƒ»ï¼", "ãƒ›": "ï¼ãƒ»ãƒ»ãƒ»",
      "ãƒ": "ï¼ãƒ»ï¼ï¼ï¼ãƒ»", "ãƒŸ": "ï¼ãƒ»ãƒ»ï¼", "ãƒ ": "ï¼ï¼ãƒ»ï¼", "ãƒ¡": "ãƒ»ï¼ãƒ»ï¼ï¼", "ãƒ¢": "ï¼ï¼",
      "ãƒ¤": "ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»", "ãƒ¦": "ï¼ï¼ãƒ»ï¼ï¼ãƒ»", "ãƒ¨": "ï¼ï¼ãƒ»ï¼ãƒ»ï¼",
      "ãƒ©": "ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼", "ãƒª": "ï¼ãƒ»ï¼ãƒ»ãƒ»ï¼", "ãƒ«": "ï¼ï¼ãƒ»ï¼ãƒ»ãƒ»", "ãƒ¬": "ãƒ»ï¼ãƒ»ï¼ãƒ»ãƒ»", "ãƒ­": "ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼",
      "ãƒ¯": "ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»", "ãƒ²": "ï¼ãƒ»ï¼ï¼ãƒ»ï¼", "ãƒ³": "ãƒ»ï¼ï¼ãƒ»",
      "ãƒ¼": "ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼ãƒ»ï¼", "ã€": "ï¼ï¼ãƒ»ãƒ»ï¼ï¼", "ã€‚": "ãƒ»ãƒ»ï¼ï¼ãƒ»ãƒ»"
    };
    const morseJPRev = Object.fromEntries(Object.entries(morseJP).map(([k,v]) => [v,k]));

    // === æ­£è¦åŒ–é–¢æ•° ===
    function normalizeMorseInput(input) {
      return input
        .replace(/ãƒ»/g, ".")
        .replace(/[ï¼¿_\-ï¼/]/g, "-")
        .replace(/\s+/g, " ")
        .trim();
    }

    // === å¤‰æ›é–¢æ•° ===
    function convert() {
      const mode = document.getElementById("mode").value;
      const direction = document.getElementById("direction").value;
      const input = document.getElementById("inputText").value.trim();
      const resultEl = document.getElementById("result");

      if (!input) {
        resultEl.innerText = "å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      let output = "";
      if (mode === "english") {
        if (direction === "text-to-morse") {
          output = input
            .toUpperCase()
            .split("")
            .map(ch => morseEN[ch] || "?")
            .join(" ");
        } else {
          const normalized = normalizeMorseInput(input);
          const words = normalized.split(" / ").map(word =>
            word.split(" ").map(code => morseENRev[code] || "?").join("")
          );
          output = words.join(" ");
        }
      } else {
        if (direction === "text-to-morse") {
          output = input
            .replace(/[ã-ã‚“]/g, c => String.fromCharCode(c.charCodeAt(0) + 0x60)) // ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ
            .split("")
            .map(ch => morseJP[ch] || "ï¼Ÿ")
            .join(" ");
        } else {
          const normalized = normalizeMorseInput(input);
          output = normalized.split(" ").map(code => morseJPRev[code] || "ï¼Ÿ").join("");
        }
      }

      resultEl.innerText = "çµæœ:\n" + output;
    }

    // === éŸ³å†ç”Ÿ ===
    async function playMorse() {
      const result = document.getElementById("result").innerText.replace(/^çµæœ:\s*/, "").trim();
      if (!result) return alert("ã¾ãšå¤‰æ›ã—ã¦ãã ã•ã„ã€‚");

      let morseStr = result;
      if (!morseStr.match(/[.\-]/)) {
        // æ–‡å­—ã‹ã‚‰ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã¸å¤‰æ›ã—ã¦å†ç”Ÿ
        document.getElementById("direction").value = "text-to-morse";
        convert();
        morseStr = document.getElementById("result").innerText.replace(/^çµæœ:\s*/, "").trim();
      }

      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const dot = 0.1; // 1å˜ä½(ç§’)
      let t = ctx.currentTime;

      for (const s of morseStr) {
        if (s === ".") {
          playTone(ctx, t, dot); t += dot * 2;
        } else if (s === "-") {
          playTone(ctx, t, dot * 3); t += dot * 4;
        } else if (s === " ") {
          t += dot * 3;
        } else if (s === "/") {
          t += dot * 7;
        }
      }
    }

    function playTone(ctx, start, duration) {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.frequency.value = 600;
      osc.type = "sine";
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.2, start);
      gain.gain.exponentialRampToValueAtTime(0.0001, start + duration);
      osc.start(start);
      osc.stop(start + duration);
    }

    // === ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ ===
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }
  </script>
</body>
</html>
