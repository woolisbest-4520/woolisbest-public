<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c5cff;
      --muted:#9aa4b2;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --glass: rgba(255,255,255,0.04);
      font-family: Inter, "Helvetica Neue", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,#071022 0%, #0f1724 100%);
      color:#e6eef6;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .container{
      width:100%;
      max-width:760px;
      background:linear-gradient(180deg,var(--card), rgba(11,18,32,0.92));
      border-radius:12px;
      padding:24px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      backdrop-filter: blur(6px);
    }
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 20px;color:var(--muted);font-size:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:200px}
    .display{
      background:var(--glass);
      padding:14px;
      border-radius:8px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .pw-text{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:16px;
      word-break:break-all;
      user-select:text;
      flex:1;
    }
    button.primary{
      background:linear-gradient(90deg,var(--accent),#5bc1ff);
      color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer;
      box-shadow: 0 6px 18px rgba(124,92,255,0.18);
    }
    button.ghost{
      background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer;
    }
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px}
    .control{
      background:rgba(255,255,255,0.02);
      padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);
    }
    label{display:flex;align-items:center;gap:8px;font-size:14px}
    input[type="range"]{width:100%}
    .muted{color:var(--muted);font-size:13px}
    .options{display:flex;flex-direction:column;gap:8px}
    .strength{
      height:10px;border-radius:999px;background:rgba(255,255,255,0.06);overflow:hidden;
    }
    .strength > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--bad),var(--warn),var(--good));transition:width 220ms ease}
    .strength-text{margin-top:8px;font-size:13px}
    .footer{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:18px}
    .small{font-size:13px;color:var(--muted)}
    footer a{color:var(--muted);text-decoration:none}
    .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:13px}
    .top-row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .copy-notice{font-size:13px;color:var(--muted)}
    /* responsive */
    @media (max-width:640px){ .controls{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container" role="main">
    <div class="top-row">
      <div>
        <h1>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ« ğŸ”</h1>
        <p class="lead">å®‰å…¨ãªãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç”Ÿæˆã—ã¾ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸ã‚“ã§ã€Œç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
      </div>
      <div style="margin-left:auto">
        <span class="chip" id="entropy-chip">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: --</span>
      </div>
    </div>

    <div class="display" aria-live="polite">
      <div class="pw-text" id="password" tabindex="0" aria-label="ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢</div>
      <button class="ghost" id="copyBtn" title="ã‚³ãƒ”ãƒ¼">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      <button class="primary" id="generateBtn" title="ç”Ÿæˆ">ç”Ÿæˆ</button>
    </div>

    <div class="controls" style="margin-top:14px">
      <div class="control">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <label for="length">é•·ã•: <strong id="lenVal">16</strong></label>
        </div>
        <input type="range" id="length" min="4" max="128" value="16" />
        <div class="muted" style="margin-top:8px">é•·ã‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ12æ–‡å­—ä»¥ä¸Šï¼‰ã‚’æ¨å¥¨ã—ã¾ã™ã€‚</div>
      </div>

      <div class="control">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:600">æ–‡å­—ç¨®</div>
          <div class="muted">å°‘ãªãã¨ã‚‚1ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        </div>
        <div class="options" style="margin-top:10px">
          <label><input type="checkbox" id="lowercase" checked /> å°æ–‡å­— (aâ€“z)</label>
          <label><input type="checkbox" id="uppercase" checked /> å¤§æ–‡å­— (Aâ€“Z)</label>
          <label><input type="checkbox" id="numbers" checked /> æ•°å­— (0â€“9)</label>
          <label><input type="checkbox" id="symbols" checked /> è¨˜å· (!@#$%...)</label>
          <label><input type="checkbox" id="no-ambiguous" /> ã‚ã„ã¾ã„æ–‡å­—ã‚’é™¤å¤– (i, l, 1, O, 0ãªã©)</label>
        </div>
      </div>
    </div>

    <div style="margin-top:14px">
      <div class="strength" aria-hidden="true">
        <i id="strengthBar" style="width:8%"></i>
      </div>
      <div class="strength-text" style="display:flex;justify-content:space-between;align-items:center">
        <div id="strengthLabel">å¼·åº¦: â€”</div>
        <div class="small" id="suggestion"></div>
      </div>
    </div>

    <div class="footer">
      <div class="copy-notice" id="copyNotice">ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼ã§ãã¾ã™</div>
      <div class="small">ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Œçµ â€” ã‚µãƒ¼ãƒãƒ¼ã¸ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“</div>
    </div>
  </div>

<script>
/*
  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆå™¨
  - å®‰å…¨ãªä¹±æ•°: crypto.getRandomValues
  - é¸æŠã—ãŸæ–‡å­—ç¨®ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡º
  - ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼è¨ˆç®— (bits): length * log2(charsetSize)
  - å¼·åº¦è¡¨ç¤º: å¼± -> ä¸­ -> å¼·
*/

(() => {
  // æ–‡å­—ã‚»ãƒƒãƒˆå®šç¾©
  const sets = {
    lowercase: 'abcdefghijklmnopqrstuvwxyz',
    uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    numbers: '0123456789',
    symbols: "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"
  };
  const ambiguous = new Set(['l','I','1','O','0','o']);

  // è¦ç´ å–å¾—
  const passwordEl = document.getElementById('password');
  const lengthEl = document.getElementById('length');
  const lenValEl = document.getElementById('lenVal');
  const lowercaseEl = document.getElementById('lowercase');
  const uppercaseEl = document.getElementById('uppercase');
  const numbersEl = document.getElementById('numbers');
  const symbolsEl = document.getElementById('symbols');
  const noAmbEl = document.getElementById('no-ambiguous');
  const generateBtn = document.getElementById('generateBtn');
  const copyBtn = document.getElementById('copyBtn');
  const strengthBar = document.getElementById('strengthBar');
  const strengthLabel = document.getElementById('strengthLabel');
  const entropyChip = document.getElementById('entropy-chip');
  const suggestion = document.getElementById('suggestion');
  const copyNotice = document.getElementById('copyNotice');

  // åˆæœŸåæ˜ 
  lenValEl.textContent = lengthEl.value;
  generate(); // èµ·å‹•æ™‚ã«ä¸€ã¤ç”Ÿæˆ

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  lengthEl.addEventListener('input', () => {
    lenValEl.textContent = lengthEl.value;
    updatePreviewStrength(); 
  });
  [lowercaseEl, uppercaseEl, numbersEl, symbolsEl, noAmbEl].forEach(el => el.addEventListener('change', updatePreviewStrength));
  generateBtn.addEventListener('click', generate);
  copyBtn.addEventListener('click', copyToClipboard);
  passwordEl.addEventListener('click', copyToClipboard); // ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼ã‚‚å¯èƒ½

  function buildCharset() {
    let pool = '';
    if (lowercaseEl.checked) pool += sets.lowercase;
    if (uppercaseEl.checked) pool += sets.uppercase;
    if (numbersEl.checked) pool += sets.numbers;
    if (symbolsEl.checked) pool += sets.symbols;
    if (!pool) return '';
    if (noAmbEl.checked) {
      pool = [...pool].filter(c => !ambiguous.has(c)).join('');
    }
    // é‡è¤‡ã‚’å‰¥ãŒã™ï¼ˆå¿µã®ãŸã‚ï¼‰ï¼š
    pool = [...new Set(pool)].join('');
    return pool;
  }

  // secure random int in [0, max)
  function secureRandomInt(max) {
    if (max <= 0) throw new Error('max must be > 0');
    // é¸ã¶ãƒã‚¤ãƒ„æ•°ã‚’æ±ºã‚ã‚‹
    const maxUint = 0xffffffff;
    const range = max;
    // Rejection sampling:
    const u32 = new Uint32Array(1);
    const threshold = Math.floor((maxUint + 1) / range) * range;
    while (true) {
      crypto.getRandomValues(u32);
      if (u32[0] < threshold) return u32[0] % range;
    }
  }

  function generate() {
    const length = Number(lengthEl.value);
    const pool = buildCharset();
    if (!pool) {
      alert('å°‘ãªãã¨ã‚‚ä¸€ã¤ã®æ–‡å­—ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
      return;
    }
    const pwChars = [];
    const poolArr = [...pool];
    // ç”Ÿæˆï¼ˆå„æ–‡å­—ã¯poolã‹ã‚‰ç‹¬ç«‹ã«é¸æŠï¼‰
    for (let i=0;i<length;i++){
      const idx = secureRandomInt(poolArr.length);
      pwChars.push(poolArr[idx]);
    }
    const pw = pwChars.join('');
    passwordEl.textContent = pw;
    updateEntropyAndStrength(pw, poolArr.length);
    copyNotice.textContent = 'ç”Ÿæˆæ¸ˆã¿ â€” ã‚³ãƒ”ãƒ¼ã§ãã¾ã™';
  }

  function estimateEntropy(length, charsetSize) {
    if (charsetSize <= 1) return 0;
    const bitsPerChar = Math.log2(charsetSize);
    return length * bitsPerChar;
  }

  function updateEntropyAndStrength(pw, charsetSize) {
    const length = pw.length;
    const entropy = estimateEntropy(length, charsetSize);
    const entropyRounded = Math.round(entropy*10)/10;
    entropyChip.textContent = `ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: ${entropyRounded} bits`;
    // å¼·åº¦è©•ä¾¡
    let label='', pct=0, color='--bad';
    if (entropy < 28) { label='éå¸¸ã«å¼±ã„'; pct = Math.min(100, entropy/28*25); color='--bad'; suggestion.textContent = 'çŸ­ã™ãã¾ã™ or æ–‡å­—ç¨®ãŒå°‘ãªã„'; }
    else if (entropy < 40) { label='å¼±ã„'; pct = 30 + (entropy-28)/(40-28)*20; color='--bad'; suggestion.textContent = 'å°‘ã—é•·ãã™ã‚‹ã‹æ–‡å­—ç¨®ã‚’å¢—ã‚„ã—ã¦ä¸‹ã•ã„'; }
    else if (entropy < 60) { label='ä¸­'; pct = 50 + (entropy-40)/(60-40)*30; color='--warn'; suggestion.textContent = 'å……åˆ†ãªç”¨é€”ãŒå¤šã„ã§ã™ï¼ˆã‚µã‚¤ãƒˆã«ã‚ˆã‚‹ï¼‰'; }
    else { label='å¼·ã„'; pct = Math.min(100, 80 + (entropy-60)/60*20); color='--good'; suggestion.textContent = 'å®‰å…¨ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ä¿ç®¡ã—ã¾ã—ã‚‡ã†'; }
    strengthLabel.textContent = `å¼·åº¦: ${label}`;
    strengthBar.style.width = pct + '%';
    // è‰²èª¿ç¯€ï¼ˆbarã¯ã‚°ãƒ©ãƒ‡ãªã®ã§å¹…ã ã‘ã§è¡¨ã™ï¼‰
    // è¡¨ç¤ºè‰²ã¯textã§è£œã†
  }

  function updatePreviewStrength() {
    const pool = buildCharset();
    const length = Number(lengthEl.value);
    if (!pool) {
      entropyChip.textContent = 'ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: â€”';
      strengthLabel.textContent = 'å¼·åº¦: â€”';
      strengthBar.style.width='8%';
      suggestion.textContent = '';
      return;
    }
    const entropy = estimateEntropy(length, pool.length);
    const entropyRounded = Math.round(entropy*10)/10;
    entropyChip.textContent = `ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: ${entropyRounded} bits`;
    // è»½ã„è©•ä¾¡è¡¨ç¤ºï¼ˆå®Ÿéš›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§è©•ä¾¡ã™ã‚‹ã‚ˆã‚Šç°¡æ˜“ï¼‰
    if (entropy < 28) { strengthLabel.textContent = 'å¼·åº¦: éå¸¸ã«å¼±ã„'; suggestion.textContent='çŸ­ã™ãã¾ã™ or æ–‡å­—ç¨®ãŒå°‘ãªã„'; strengthBar.style.width='16%'; }
    else if (entropy < 40) { strengthLabel.textContent = 'å¼·åº¦: å¼±ã„'; suggestion.textContent='å°‘ã—é•·ãã™ã‚‹ã‹æ–‡å­—ç¨®ã‚’å¢—ã‚„ã—ã¦ä¸‹ã•ã„'; strengthBar.style.width='40%'; }
    else if (entropy < 60) { strengthLabel.textContent = 'å¼·åº¦: ä¸­'; suggestion.textContent='å……åˆ†ãªç”¨é€”ãŒå¤šã„ã§ã™ï¼ˆã‚µã‚¤ãƒˆã«ã‚ˆã‚‹ï¼‰'; strengthBar.style.width='64%'; }
    else { strengthLabel.textContent = 'å¼·åº¦: å¼·ã„'; suggestion.textContent='å®‰å…¨ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ä¿ç®¡ã—ã¾ã—ã‚‡ã†'; strengthBar.style.width='90%'; }
  }

  async function copyToClipboard() {
    const text = passwordEl.textContent;
    if (!text || text.trim()==='' || text.includes('â€¢')) {
      copyNotice.textContent = 'ã¾ãšãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      copyNotice.textContent = 'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸ âœ…';
      // ä¸€æ™‚çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
      const old = copyBtn.textContent;
      copyBtn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
      setTimeout(()=> copyBtn.textContent = old, 1500);
    } catch (e) {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      try {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position='fixed';
        ta.style.left='-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        copyNotice.textContent = 'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸ';
      } catch (err) {
        copyNotice.textContent = 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®è¨±å¯ãŒå¿…è¦ï¼‰';
      }
    }
  }

})();
</script>
</body>
</html>
